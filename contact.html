<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Fiche Contact</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f4f4f4; }
    .container { background: white; max-width: 500px; margin: auto; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px #ccc; }
    img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 10px; }
    .field { margin-bottom: 10px; }
    .field label { font-weight: bold; display: block; }
  </style>
</head>
<body>
  <div class="container" id="contactContainer">Chargement...</div>

  <script>
    async function fetchContactData() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get('id');

      if (!id) {
        document.getElementById('contactContainer').innerText = "Aucun ID fourni.";
        return;
      }

      try {
        const response = await fetch(`contacts/${id}.json`);
        if (!response.ok) throw new Error('Contact introuvable');
        const data = await response.json();

        const vcfData = `BEGIN:VCARD
VERSION:3.0
N:${data.nom};${data.prenom}
FN:${data.prenom} ${data.nom}
ORG:${data.societe}
TITLE:${data.fonction}
TEL:${data.telephone}
EMAIL:${data.email}
URL:${data.siteweb}
NOTE:${data.description}
END:VCARD`;

        const blob = new Blob([vcfData], { type: "text/vcard" });
        const vcfURL = URL.createObjectURL(blob);

        document.getElementById('contactContainer').innerHTML = `
          <img src="photos/${data.photo}" alt="Photo de ${data.prenom}" />
          <div class="field"><label>Nom :</label>${data.prenom} ${data.nom}</div>
          <div class="field"><label>Entreprise :</label>${data.societe}</div>
          <div class="field"><label>Fonction :</label>${data.fonction}</div>
          <div class="field"><label>Téléphone :</label><a href="tel:${data.telephone}">${data.telephone}</a></div>
          <div class="field"><label>Email :</label><a href="mailto:${data.email}">${data.email}</a></div>
          <div class="field"><label>Site web :</label><a href="${data.siteweb}" target="_blank">${data.siteweb}</a></div>
          <div class="field"><label>Description :</label>${data.description}</div>
          <div class="field"><label>Réseaux sociaux :</label>
            ${data.instagram ? `<a href="${data.instagram}" target="_blank">Instagram</a><br>` : ''}
            ${data.linkedin ? `<a href="${data.linkedin}" target="_blank">LinkedIn</a><br>` : ''}
            ${data.googlebusiness ? `<a href="${data.googlebusiness}" target="_blank">Google Business</a><br>` : ''}
            ${data.facebook ? `<a href="${data.facebook}" target="_blank">Facebook</a>` : ''}
          </div>
          <br>
          <a href="${vcfURL}" download="${data.nom}_${data.prenom}.vcf">
            <button>Ajouter à mes contacts</button>
          </a>
        `;
      } catch (error) {
        document.getElementById('contactContainer').innerText = "Erreur : " + error.message;
      }
    }

    fetchContactData();
  </script>
</body>
</html>
