<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Générateur de lien court</title>
</head>
<body>
  <h1>Générateur de lien court vers fiche contact</h1>
  <form id="linkForm">
    <!-- Menu déroulant des contacts -->
    <label for="contactSelect">Choisir un contact :</label>
    <select id="contactSelect">
      <option value="">-- Sélectionnez un contact --</option>
    </select>
    <!-- Champ caché qui recevra l'ID (nom_prenom) -->
    <input type="hidden" id="contactID" name="id" />

    <!-- Bouton pour générer le lien -->
    <button type="button" onclick="generateLink()">Générer le lien</button>
  </form>

  <!-- Affichage du lien généré -->
  <p>Lien généré : <a id="shortLink" href="#" target="_blank">--</a></p>

  <!-- Script JavaScript pour charger le JSON et gérer le dropdown -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Charger le fichier contacts/index.json
      fetch('contacts/index.json')
        .then(response => {
          if (!response.ok) throw new Error('Impossible de charger les contacts');
          return response.json();
        })
        .then(data => {
          const select = document.getElementById('contactSelect');
          data.forEach(contact => {
            const option = document.createElement('option');
            option.value = contact.id;  // ex: "Jean_Dupont"
            option.textContent = contact.prenom + ' ' + contact.nom; // ex: "Jean Dupont"
            select.appendChild(option);
          });
        })
        .catch(err => console.error('Erreur:', err));

      // Quand on change la sélection, mettre à jour le champ ID caché
      document.getElementById('contactSelect').addEventListener('change', function() {
        document.getElementById('contactID').value = this.value;
      });
    });

    // Fonction pour générer et afficher le lien court
    function generateLink() {
      const id = document.getElementById('contactID').value;
      if (!id) {
        alert("Veuillez sélectionner un contact.");
        return;
      }
      // Construction du lien (contact.html?nom_prenom)
      const url = window.location.origin + window.location.pathname.replace(/index\.html$/, '') 
                + 'contact.html?' + encodeURIComponent(id);
      // Afficher le lien dans la page
      const link = document.getElementById('shortLink');
      link.href = url;
      link.textContent = url;
    }
  </script>
</body>
</html>
    }
  </script>
</body>
</html>
